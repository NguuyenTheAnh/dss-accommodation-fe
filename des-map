# MÃ” Táº¢ CÃC CÃ”NG Cá»¤ Báº¢N Äá»’ (MAPPING TOOLS) TRONG Dá»° ÃN

## 1. THÆ¯ VIá»†N CHÃNH

### Leaflet (v1.9.4)
- ThÆ° viá»‡n JavaScript mÃ£ nguá»“n má»Ÿ Ä‘á»ƒ tÃ­ch há»£p báº£n Ä‘á»“ tÆ°Æ¡ng tÃ¡c
- Nháº¹, hiá»‡u suáº¥t cao vÃ  dá»… sá»­ dá»¥ng
- Cung cáº¥p cÃ¡c tÃ­nh nÄƒng cÆ¡ báº£n Ä‘á»ƒ hiá»ƒn thá»‹ vÃ  thao tÃ¡c vá»›i báº£n Ä‘á»“

### React-Leaflet (v4.2.1)
- Wrapper cá»§a Leaflet dÃ nh cho React
- Cung cáº¥p cÃ¡c React components Ä‘á»ƒ tÃ­ch há»£p Leaflet vÃ o á»©ng dá»¥ng React
- Cho phÃ©p sá»­ dá»¥ng cÃº phÃ¡p JSX Ä‘á»ƒ lÃ m viá»‡c vá»›i báº£n Ä‘á»“

## 2. NGUá»’N Dá»® LIá»†U Báº¢N Äá»’

### OpenStreetMap (OSM)
- Tile layer URL: "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
- Cung cáº¥p dá»¯ liá»‡u báº£n Ä‘á»“ miá»…n phÃ­ vÃ  mÃ£ nguá»“n má»Ÿ
- Hiá»ƒn thá»‹ Ä‘á»‹a hÃ¬nh, Ä‘Æ°á»ng xÃ¡, Ä‘á»‹a Ä‘iá»ƒm trÃªn toÃ n tháº¿ giá»›i

## 3. CÃC COMPONENT VÃ€ CHá»¨C NÄ‚NG CHÃNH

### A. MapContainer
- Component chá»©a toÃ n bá»™ báº£n Ä‘á»“
- Thiáº¿t láº­p:
  - center: Tá»a Ä‘á»™ trung tÃ¢m ban Ä‘áº§u cá»§a báº£n Ä‘á»“
  - zoom: Má»©c Ä‘á»™ phÃ³ng to (zoom level)
  - whenCreated: Callback Ä‘á»ƒ lÆ°u instance cá»§a map
  - style: KÃ­ch thÆ°á»›c vÃ  kiá»ƒu dÃ¡ng cá»§a container

### B. TileLayer
- Hiá»ƒn thá»‹ lá»›p tiles (Ã´ báº£n Ä‘á»“) tá»« OpenStreetMap
- Render cÃ¡c Ã´ báº£n Ä‘á»“ dá»±a trÃªn zoom level vÃ  vá»‹ trÃ­

### C. Marker
- ÄÃ¡nh dáº¥u Ä‘iá»ƒm trÃªn báº£n Ä‘á»“
- Sá»­ dá»¥ng icon máº·c Ä‘á»‹nh hoáº·c custom icon
- position: Tá»a Ä‘á»™ [lat, lng] cá»§a marker
- Trong dá»± Ã¡n:
  - Marker cho vá»‹ trÃ­ nhÃ  (House)
  - Marker cho vá»‹ trÃ­ trÆ°á»ng há»c (School) vá»›i icon emoji ğŸ“

### D. Popup
- Hiá»ƒn thá»‹ thÃ´ng tin khi click vÃ o Marker
- DÃ¹ng Ä‘á»ƒ hiá»ƒn thá»‹ nhÃ£n "House" hoáº·c "School"

### E. Polyline
- Váº½ Ä‘Æ°á»ng ná»‘i giá»¯a cÃ¡c Ä‘iá»ƒm
- Hiá»ƒn thá»‹ tuyáº¿n Ä‘Æ°á»ng tá»« nhÃ  Ä‘áº¿n trÆ°á»ng
- Thuá»™c tÃ­nh:
  - positions: Máº£ng cÃ¡c tá»a Ä‘á»™ [[lat, lng], ...]
  - color: MÃ u sáº¯c Ä‘Æ°á»ng line (#3b82f6 - mÃ u xanh dÆ°Æ¡ng)
  - weight: Äá»™ dÃ y cá»§a Ä‘Æ°á»ng (5px)

### F. useMapEvents (Custom Hook)
- Component MapClickCatcher sá»­ dá»¥ng hook nÃ y
- Báº¯t sá»± kiá»‡n click trÃªn báº£n Ä‘á»“
- Láº¥y tá»a Ä‘á»™ Ä‘iá»ƒm Ä‘Æ°á»£c click: [lat, lng]
- DÃ¹ng trong trang Add House Ä‘á»ƒ chá»n vá»‹ trÃ­

## 4. QUáº¢N LÃ ICON

### Cáº¥u hÃ¬nh icon máº·c Ä‘á»‹nh (leaflet.js)
- Import cÃ¡c file áº£nh icon tá»« Leaflet:
  - marker-icon-2x.png: Icon Ä‘á»™ phÃ¢n giáº£i cao
  - marker-icon.png: Icon Ä‘á»™ phÃ¢n giáº£i thÆ°á»ng
  - marker-shadow.png: BÃ³ng Ä‘á»• cá»§a marker
- Thiáº¿t láº­p:
  - iconSize: [25, 41] - KÃ­ch thÆ°á»›c icon
  - iconAnchor: [12, 41] - Äiá»ƒm neo cá»§a icon
  - popupAnchor: [1, -34] - Vá»‹ trÃ­ popup xuáº¥t hiá»‡n

### Custom Icon cho School
- Sá»­ dá»¥ng L.DivIcon
- className: "school-marker"
- html: "ğŸ“" (emoji ngÃ´i trÆ°á»ng)

## 5. Há»† THá»NG Tá»ŒA Äá»˜

### Äá»‹nh dáº¡ng tá»a Ä‘á»™
- Sá»­ dá»¥ng há»‡ tá»a Ä‘á»™ WGS84 (latitude, longitude)
- Format: [latitude, longitude]
- VÃ­ dá»¥: [21.0285, 105.8544] (HÃ  Ná»™i, Viá»‡t Nam)

### Xá»­ lÃ½ tá»a Ä‘á»™ trong code
- DEFAULT_CENTER/FALLBACK_CENTER: [21.0285, 105.8544]
- HÃ m asLatLng(): Chuyá»ƒn Ä‘á»•i nhiá»u format tá»a Ä‘á»™ khÃ¡c nhau vá» [lat, lng]
- HÃ m toLatLngPairs(): Chuyá»ƒn Ä‘á»•i máº£ng coordinates tá»« backend (format [lng, lat]) sang [lat, lng]

## 6. TÃNH NÄ‚NG Láº¤Y Vá»Š TRÃ

### Geolocation API
- navigator.geolocation.getCurrentPosition()
- Tá»± Ä‘á»™ng láº¥y vá»‹ trÃ­ hiá»‡n táº¡i cá»§a ngÆ°á»i dÃ¹ng
- Options:
  - enableHighAccuracy: true - Äá»™ chÃ­nh xÃ¡c cao
  - timeout: 8000ms - Thá»i gian chá»
- Fallback vá» vá»‹ trÃ­ máº·c Ä‘á»‹nh náº¿u khÃ´ng láº¥y Ä‘Æ°á»£c

### CÃ¡c tráº¡ng thÃ¡i geolocation
- "Centering on your location..." - Äang xÃ¡c Ä‘á»‹nh vá»‹ trÃ­
- "Location detected. Drop a pin to adjust." - ÄÃ£ xÃ¡c Ä‘á»‹nh thÃ nh cÃ´ng
- "Could not detect location. Using default center." - KhÃ´ng láº¥y Ä‘Æ°á»£c vá»‹ trÃ­
- "Geolocation unavailable. Using default center." - TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£

## 7. CÃC CHá»¨C NÄ‚NG Báº¢N Äá»’ TRONG Dá»° ÃN

### Trang Home (home.jsx)
a) Hiá»ƒn thá»‹ route (tuyáº¿n Ä‘Æ°á»ng):
   - Váº½ Polyline tá»« nhÃ  Ä‘áº¿n trÆ°á»ng
   - Hiá»ƒn thá»‹ 2 Markers: House vÃ  School
   - Tá»± Ä‘á»™ng center map theo geometry cá»§a route

b) Modal xem chi tiáº¿t route:
   - MapContainer vá»›i zoom 14
   - Hiá»ƒn thá»‹ Ä‘Æ°á»ng Ä‘i mÃ u xanh dÆ°Æ¡ng
   - Popup thÃ´ng tin khi click vÃ o marker

c) Sáº¯p xáº¿p routes theo khoáº£ng cÃ¡ch:
   - TÃ­nh distanceKm tá»« API
   - Format hiá»ƒn thá»‹: X.XX km

### Trang Add House (add-house.jsx)
a) TÆ°Æ¡ng tÃ¡c vá»›i báº£n Ä‘á»“:
   - Click Ä‘á»ƒ Ä‘áº·t marker (drop pin)
   - MapClickCatcher báº¯t sá»± kiá»‡n click
   - Cáº­p nháº­t tá»a Ä‘á»™ realtime

b) Hiá»ƒn thá»‹ thÃ´ng tin:
   - Coordinates dáº¡ng: "Lat X.XXXXXX, Lng Y.YYYYYY"
   - 6 chá»¯ sá»‘ tháº­p phÃ¢n cho Ä‘á»™ chÃ­nh xÃ¡c cao
   - ReadOnly input Ä‘á»ƒ hiá»ƒn thá»‹ tá»a Ä‘á»™

c) Khá»Ÿi táº¡o vá»‹ trÃ­:
   - Tá»± Ä‘á»™ng láº¥y vá»‹ trÃ­ hiá»‡n táº¡i qua Geolocation
   - Center map vÃ  Ä‘áº·t marker táº¡i vá»‹ trÃ­ ngÆ°á»i dÃ¹ng
   - Zoom level 15 cho Ä‘á»™ chi tiáº¿t cao

## 8. TÆ¯Æ NG TÃC Vá»šI MAP INSTANCE

### map.setView(center, zoom)
- Thay Ä‘á»•i vá»‹ trÃ­ trung tÃ¢m vÃ  má»©c zoom cá»§a báº£n Ä‘á»“
- ÄÆ°á»£c gá»i khi:
  - Chá»n route Ä‘á»ƒ xem
  - PhÃ¡t hiá»‡n vá»‹ trÃ­ ngÆ°á»i dÃ¹ng
  - Load geometry má»›i

### whenCreated callback
- LÆ°u reference Ä‘áº¿n map instance
- Cho phÃ©p Ä‘iá»u khiá»ƒn map tá»« React component
- Sá»­ dá»¥ng trong cáº£ 2 trang Home vÃ  Add House

## 9. Xá»¬ LÃ Dá»® LIá»†U GEOMETRY

### Chuyá»ƒn Ä‘á»•i format tá»a Ä‘á»™
- Backend tráº£ vá» format GeoJSON: [lng, lat]
- Frontend cáº§n format Leaflet: [lat, lng]
- toLatLngPairs() thá»±c hiá»‡n chuyá»ƒn Ä‘á»•i vÃ  validate

### CÃ¡c trÆ°á»ng dá»¯ liá»‡u cÃ³ thá»ƒ
- geometry, coordinates, routeGeometry
- house/origin/from cho Ä‘iá»ƒm Ä‘áº§u
- school/destination/to cho Ä‘iá»ƒm cuá»‘i
- Há»‡ thá»‘ng flexible xá»­ lÃ½ nhiá»u format khÃ¡c nhau

## 10. STYLING & UI

### CSS cho báº£n Ä‘á»“
- Import "leaflet/dist/leaflet.css" trong App.jsx
- Custom CSS trong global.css
- className "map-shell" vÃ  "map-shell tall" cho container
- Modal overlay Ä‘á»ƒ hiá»ƒn thá»‹ báº£n Ä‘á»“ route

### Responsive
- style={{ height: "100%", width: "100%" }}
- Container chiáº¿m toÃ n bá»™ khÃ´ng gian Ä‘Æ°á»£c cáº¥p
- TÆ°Æ¡ng thÃ­ch vá»›i layout responsive

## 11. TÃCH Há»¢P Vá»šI BACKEND API

### Endpoints sá»­ dá»¥ng
- GET /api/houses - Láº¥y danh sÃ¡ch nhÃ 
- POST /api/houses - ThÃªm nhÃ  má»›i (bao gá»“m lat, lng)
- GET /api/routes?schoolName=X - TÃ¬m routes tá»« nhÃ  Ä‘áº¿n trÆ°á»ng

### Dá»¯ liá»‡u lÆ°u trá»¯
- Má»—i house cÃ³: name, address, lat, lng
- Route cÃ³: house, school, geometry, distanceKm

## Káº¾T LUáº¬N

Dá»± Ã¡n sá»­ dá»¥ng Leaflet + React-Leaflet Ä‘á»ƒ xÃ¢y dá»±ng há»‡ thá»‘ng báº£n Ä‘á»“ tÆ°Æ¡ng tÃ¡c giÃºp:
- TÃ¬m kiáº¿m vÃ  hiá»ƒn thá»‹ tuyáº¿n Ä‘Æ°á»ng tá»« nhÃ  cho thuÃª Ä‘áº¿n trÆ°á»ng há»c
- ThÃªm vá»‹ trÃ­ nhÃ  má»›i báº±ng cÃ¡ch click trÃªn báº£n Ä‘á»“
- Tá»± Ä‘á»™ng xÃ¡c Ä‘á»‹nh vá»‹ trÃ­ ngÆ°á»i dÃ¹ng
- Hiá»ƒn thá»‹ routes vá»›i Polyline, Markers, vÃ  Popups
- TÃ­ch há»£p OpenStreetMap lÃ m nguá»“n tiles miá»…n phÃ­

Táº¥t cáº£ cÃ¡c tÃ­nh nÄƒng Ä‘á»u Ä‘Æ°á»£c xÃ¢y dá»±ng vá»›i UX thÃ¢n thiá»‡n, responsive vÃ  xá»­ lÃ½ lá»—i tá»‘t.
